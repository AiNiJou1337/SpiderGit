# çˆ¬è™«æ•°æ®åº“ä¿å­˜é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜æè¿°

åœ¨è¿è¡Œå…³é”®è¯çˆ¬è™«æ—¶ï¼Œå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š
```
å…³ç³» "code_files" çš„ "importedlibraries" å­—æ®µä¸å­˜åœ¨
LINE 5: importedlibraries, created_at, updated_a...
```

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **å­—æ®µåä¸åŒ¹é…**: æ•°æ®åº“æ¨¡å¼ä¸­å­—æ®µåä¸º `importedLibraries`ï¼ˆé©¼å³°å‘½åï¼‰ï¼Œä½†SQLæŸ¥è¯¢ä¸­ä½¿ç”¨çš„æ˜¯ `importedlibraries`ï¼ˆå…¨å°å†™ï¼‰
2. **æ•°æ®éªŒè¯ä¸è¶³**: ä¿å­˜å‡½æ•°ç¼ºä¹å¯¹è¾“å…¥æ•°æ®çš„éªŒè¯
3. **é”™è¯¯å¤„ç†ä¸å®Œå–„**: é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†ï¼Œéš¾ä»¥å®šä½é—®é¢˜

### å…·ä½“é—®é¢˜ç‚¹
- `backend/scraper/keyword_scraper.py` ç¬¬506-538è¡Œçš„SQLè¯­å¥ä¸­ä½¿ç”¨äº†é”™è¯¯çš„å­—æ®µå
- ç¼ºå°‘å¯¹åˆ†æç»“æœæ•°æ®ç»“æ„çš„éªŒè¯
- æ²¡æœ‰ç”Ÿæˆåˆ†æJSONæ–‡ä»¶çš„åŠŸèƒ½

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤å­—æ®µåé—®é¢˜
**æ–‡ä»¶**: `backend/scraper/keyword_scraper.py`

**ä¿®æ”¹å‰**:
```sql
importedlibraries, created_at, updated_at
```

**ä¿®æ”¹å**:
```sql
"importedLibraries", created_at, updated_at
```

### 2. æ”¹è¿›æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
**å¢å¼ºçš„ `save_code_analysis_to_db` å‡½æ•°**:
- æ·»åŠ è¾“å…¥æ•°æ®éªŒè¯
- æ”¹è¿›é”™è¯¯æ—¥å¿—è®°å½•
- æ·»åŠ ä¿å­˜è®¡æ•°å™¨
- æ›´å¥½çš„å¼‚å¸¸å¤„ç†

### 3. æ–°å¢åˆ†æJSONç”ŸæˆåŠŸèƒ½
**æ–°å¢ `generate_analysis_json` å‡½æ•°**:
- ä»æ•°æ®åº“è¯»å–å…³é”®è¯ç›¸å…³æ•°æ®
- ç”Ÿæˆç»Ÿè®¡åˆ†æç»“æœ
- ä¿å­˜ä¸ºJSONæ–‡ä»¶åˆ° `public/analytics/` ç›®å½•
- æ”¯æŒè¯­è¨€åˆ†å¸ƒã€åº“ä½¿ç”¨ã€å‡½æ•°ç»Ÿè®¡ç­‰åˆ†æ

### 4. å®Œå–„çˆ¬è™«æµç¨‹
**æ”¹è¿›ä¸»æµç¨‹**:
- çˆ¬è™«å®Œæˆåè‡ªåŠ¨ç”Ÿæˆåˆ†æç»“æœ
- æ›´æ–°ä»»åŠ¡è¿›åº¦çŠ¶æ€
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `backend/scraper/keyword_scraper.py`
- **ä¿®å¤**: SQLå­—æ®µåä» `importedlibraries` æ”¹ä¸º `"importedLibraries"`
- **æ”¹è¿›**: `save_code_analysis_to_db` å‡½æ•°çš„æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
- **æ–°å¢**: `generate_analysis_json` å‡½æ•°ç”¨äºç”Ÿæˆåˆ†æç»“æœ
- **æ–°å¢**: `from collections import Counter` å¯¼å…¥
- **æ”¹è¿›**: ä¸»æµç¨‹ä¸­æ·»åŠ åˆ†æç”Ÿæˆæ­¥éª¤

### 2. `backend/test_fix.py` (æ–°å¢)
- æ•°æ®åº“è¿æ¥æµ‹è¯•
- ä»£ç åˆ†æä¿å­˜åŠŸèƒ½æµ‹è¯•
- è¡¨ç»“æ„éªŒè¯

## ğŸ¯ ä¿®å¤æ•ˆæœ

### è§£å†³çš„é—®é¢˜
1. âœ… **å­—æ®µåé”™è¯¯**: ä¿®å¤äº† `importedLibraries` å­—æ®µåä¸åŒ¹é…é—®é¢˜
2. âœ… **æ•°æ®ä¿å­˜å¤±è´¥**: ä»£ç åˆ†æç»“æœç°åœ¨å¯ä»¥æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
3. âœ… **ç¼ºå°‘åˆ†ææ–‡ä»¶**: è‡ªåŠ¨ç”ŸæˆJSONåˆ†ææ–‡ä»¶åˆ° `public/analytics/`
4. âœ… **é”™è¯¯å¤„ç†**: æ”¹è¿›äº†é”™è¯¯æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†

### æ–°å¢åŠŸèƒ½
1. ğŸ†• **è‡ªåŠ¨åˆ†æç”Ÿæˆ**: çˆ¬è™«å®Œæˆåè‡ªåŠ¨ç”Ÿæˆåˆ†æJSONæ–‡ä»¶
2. ğŸ†• **æ•°æ®ç»Ÿè®¡**: åŒ…å«è¯­è¨€åˆ†å¸ƒã€åº“ä½¿ç”¨ã€å‡½æ•°ç»Ÿè®¡ç­‰
3. ğŸ†• **è¿›åº¦è·Ÿè¸ª**: å®Œæ•´çš„ä»»åŠ¡è¿›åº¦æ›´æ–°
4. ğŸ†• **æµ‹è¯•å·¥å…·**: æä¾›æµ‹è¯•è„šæœ¬éªŒè¯ä¿®å¤æ•ˆæœ

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•
```bash
cd backend
python test_fix.py
```

### é¢„æœŸè¾“å‡º
```
å¼€å§‹æµ‹è¯•ä¿®å¤åçš„åŠŸèƒ½...
æ•°æ®åº“è¿æ¥æˆåŠŸ: PostgreSQL 13.x...
code_files è¡¨ç»“æ„:
  id: integer
  filename: character varying
  path: character varying
  ...
  importedLibraries: ARRAY
æµ‹è¯•ä¿å­˜ä»£ç åˆ†æç»“æœ...
ä¿å­˜äº† 2 ä¸ªæ–‡ä»¶çš„åˆ†æç»“æœ
ä¿å­˜æµ‹è¯•å®Œæˆ
æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

### è¿è¡Œçˆ¬è™«æµ‹è¯•
```bash
cd backend
python -m scraper.keyword_scraper --keywords "test" --languages "python" --limits "5"
```

## ğŸ“Š æ•°æ®åº“æ¨¡å¼ç¡®è®¤

### CodeFile è¡¨ç»“æ„
```prisma
model CodeFile {
  id                Int        @id @default(autoincrement())
  filename          String
  path              String
  content           String?
  comments          String?
  functions         String[]
  packages          String[]
  components        String[]
  api_endpoints     String[]
  importedLibraries String[]  // æ­£ç¡®çš„å­—æ®µå
  repository_id     Int
  repository        Repository @relation(fields: [repository_id], references: [id])
  created_at        DateTime   @default(now())
  updated_at        DateTime   @updatedAt

  @@unique([repository_id, path])
  @@map("code_files")
}
```

## ğŸ”„ åç»­å»ºè®®

1. **ç›‘æ§**: æ·»åŠ æ›´å¤šçš„ç›‘æ§å’Œæ—¥å¿—è®°å½•
2. **æµ‹è¯•**: ç¼–å†™æ›´å…¨é¢çš„å•å…ƒæµ‹è¯•
3. **æ€§èƒ½**: ä¼˜åŒ–å¤§é‡æ•°æ®çš„æ‰¹é‡æ’å…¥
4. **æ‰©å±•**: æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€çš„ä»£ç åˆ†æ

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
2. Prisma æ¨¡å¼æ˜¯å¦å·²åŒæ­¥åˆ°æ•°æ®åº“
3. ç¯å¢ƒå˜é‡ `DATABASE_URL` æ˜¯å¦æ­£ç¡®é…ç½®
4. æ—¥å¿—æ–‡ä»¶ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
